name: inverse
layout: true
class: center, middle, inverse

---
# 考古学における地域研究 
地域考古学B-2020年度第4回目
2020/5/29
[授業ページトップに戻る](https://kotdijian.github.io/ChiikiKoukoB-2020/)

---
layout: false
###### 1
### 前回までの振り返り
* 考古学資料・情報を集める ＞ 文献一覧  
* 分布図作成の準備 ＞ 位置情報の収集  
* 「[ひなたGIS](https://hgis.pref.miyazaki.lg.jp/hinata/hinata.html)」を使って分布図を作成しよう ＜ ここから  

--

### 事後学習課題の確認  
* [東京都遺跡地図](https://tokyo-iseki.metro.tokyo.lg.jp/)からデータのコピペ・一覧化  
    **一覧表で提供してくれていたら便利ですよね?**  

--

### 今日のリソース
* **Googleドキュメント第4回まとめ**  

---
###### 2
## 1.作成したリストを地図に表示してみよう  
* 作成したのはGoogleスプレッドシートです([ここ](https://drive.google.com/open?id=1cpXZL8DHN-FgYrT0gf26M-nGSZwBG8qQOZJA8U2n18o))  

--

* 「ひなたGIS」に読み込めるのは.csv形式です  
    * .csv形式とは? ([CSVファイル「パソコン初心者講座」](http://www.pc-master.jp/sousa/csv.html)  
    
    * テキストファイルとバイナリファイル（[ウィキペディア「テキストファイル」より](https://ja.wikipedia.org/wiki/%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A8%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB)  

    * 機械可読(machine readable)と人間可読(human readable) ＜ 前回  

--

* Googleスプレッドシートから.csv形式のファイルを書き出します  

--

**☞その前に...**

--
**位置情報が入っていないんじゃ...?**  

---
###### 3
## 2.住所から位置座標を取得する：ジオコーディング
* ジオコーディングとは? ([ウィキペディア「ジオコーディング」](https://ja.wikipedia.org/wiki/%E3%82%B8%E3%82%AA%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0))  

* [国土交通省「位置参照情報ダウンロードサービス」](https://nlftp.mlit.go.jp/isj/)  

* [Geocording](https://www.geocoding.jp/)

--

* 「ひなたGIS」では「変換元住所」という列の情報を読み込み、地図上に位置を落とします  

    ☞ 自分のリストの **「所在地」** を **「変換元住所」** に書き換えよう  

    ☞ 「ファイル」→「ダウンロード」→「カンマ区切りの値」→フォルダとファイル名を指定  

--
* 位置座標(緯度経度)をすでに入力済みの人は、いったん座標なしのファイルを作成  

---
###### 4
## 3.テキストファイル(.csv含む)の形式について  
* 保存した.csvファイルをひなたGISにドラッグ+ドロップ  

☞ あれ? 開けない???  

* 保存したcsvファイルをテキストエディタ(メモ帳など)かExcelで開いてみる  

☞ 読めるかたちで表示されますか?  

* テキストデータのエンコード(日本語の文字コード)  

    * 文字コードとは？（[技術評論社「知っておきたい! 文字コードの基礎知識」](https://gihyo.jp/book/pickup/2019/0006))  

    * Googleスプレッドシートから書き出された.csvはunicode(UTF-8)というエンコード  

    * Excelで表示したり「ひなたGIS」に読み込ませるにはシフトJIS  
    
* UTF-8の.csvファイルをシフトJISに変換して保存しよう  

---
###### 5
## 3-2.テキスト・ファイルのエンコードの変更  
* スプレッドシートからダウンロード  
    * 「ファイル」→「ダウンロード」→「カンマ区切りの値(.csv、現在のシート)  
    * ※このときファイルのエンコードは**UTF-8**です!!  
    * ※これを**シフトJIS**に変更する必要があります!!  

* 次の2つの方法のいずれかで.csvファイルのエンコードをシフトJISにします  
    1. メモ帳を使用：  
    * .csvファイルをメモ帳で開く→「ファイル」→「名前を付けて保存」  
    * →「保存」ボタンの左の**「文字コード」**を**ANSI**にして保存する  

    2. Excelを使用：  
    * 「データ」→「テキストまたはCSVから」→ファイルを指定  
    * 新しく開いたウィンドウの左上の「元のファイル」を「Unicode(UTF-8)」に変更  
    * 文字化けが直ったのを確認して「データの変換」をクリック  
    * 新しく開いたPower Queryエディター・ウィンドウの左端「閉じて読み込む」をクリック  
    * 「ファイル」→「名前を付けて保存」→保存先とファイル名を指定  
    *  →ファイル形式(ファイル名の下)を**「CSV (コンマ区切り)」**に指定して保存  
    * **※重要**「CSV UTF-8 (コンマ区切り)」ではありません!!  

---
###### 6
## 4.位置座標の精度・解像度と代表点・ポリゴン  
* もう一度「ひなたGIS」に読み込ませよう  

* 「東京都遺跡地図」の遺跡位置(範囲)と比較してみよう  

* 住所から変換した位置座標は「代表点」です  

    ⇔ 「東京都遺跡地図」では範囲(ポリゴン)です  

    ☞ とりあえず現時点では「点」で位置を表しましょう  
    
---
###### 7
## 5. 「ひなたGIS」で位置座標(緯度・経度)を取得する  

* 「ひなたGIS」上の点を**右クリック**→左クリックでドラッグ→移動可能  

* 「東京都遺跡地図」を参照して、遺跡範囲の「代表点」に設定  

---
###### 8
## 6.「ひなたGIS」から取得データを書き出す  

* 画面上のどこでも良いので右クリック→「ファイル」→「**csv保存**」  

---
###### 9
## 7.これは遺跡データベースです

* データベースとは?
    * [ウィキペディア「データベース」](https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9)  
    
    > データベース（英: database, DB）とは、検索や蓄積が容易にできるよう整理された情報の集まり。 通常はコンピュータによって実現されたものを指す。コンピュータを使用したデータベース・システムでは、データベース管理用のソフトウェアであるデータベース管理システムを使用する場合も多い。  

--
* レコード：ひとつながりのデータセット、スプレッドシートの行、カード(帳票)  
    * 「東京都遺跡地図」の2つの表示方法 ⇔ データセットは同じ  

---
###### 10
## 8.データベースを管理する

* UID：ひとつのレコードを他と区別する、識別子  


* 遺跡データベースのUIDは何か?  

    * ユニークな、他と重複しない、一意の記号や番号  

* ×遺跡名：重複がある 文字の表記ゆれ?  

* ×遺跡番号：区市町村ごとに繰り返す...  

* ×区市町村名+遺跡番号：合併、名称の変更...  

* **自治体コード**：総務省が定めた自治体のUID  
    * **重複はなく恒久的(とされる)**  
    * 参考：J-LIS地方公共団体情報システム機構「地方公共団体コード住所」(https://www.j-lis.go.jp/spd/code-address/jititai-code.html)  

* **☞ 自治体コード+遺跡番号 !!**: JASIDとして追加してあります(枝番処理済み)  

---
###### 11
## 8-2. UIDの付番・管理について(補足)  

* 東京都遺跡地図には「枝番」が出てくる  

.left-column {
* 府中市の事例：古墳の場合  

|遺跡番号|ふりがな|  
|:--:|:--:|
|3|みたけづか|  
|4-1|たかくらこふんぐん1ごうふん|  
|4-2|たかくらこふんぐん2ごうふん|  
|---|------|  
|4-I|みみづか|  
|4-K|おおつか|  

※ 親番号に遺跡登録無し、アルファベットも!!  
}

.right-column{
* 調布市の事例：遺跡内の地点?  

|遺跡番号|ふりがな|  
|--:|:--:|  
|29-1|ませぐちいせき|  
|29-2|ませぐちこせんしゅつどち|  

※29-1が親番号?(遺跡全体?)、29-2が特定地点?  
}

---
###### 11
## 7-2. UIDの付番・管理について(補足)  

* 枝番はデータベース、データ処理上、できる限り避けるべき

--

* なぜ枝番は良くないのかを考えてみよう

---
###### 12
## 8. データベースの中身を見てみよう(ここから第5回)  

* **1行目は「タイトル行」**  

--

1. (JASID)  
2. (自治体コード)  
3. 遺跡番号  
4. ふりがな  
5. 遺跡名  
6. 変換元住所(所在地)  
7. 時代  
8. 種別  
9. 主な遺構/概要  
10. 主な出土品  
11. (色)  
12. (経度)  
13. (緯度)  

---

